# SantechStore - Онлайн Магазин Сантехники

## Описание

Проект онлайн магазина сантехники, предоставляющий базовые функциональности для взаимодействия с покупателями

## Название
SantechStore - Онлайн Магазин Сантехники

## Предметная область
Онлайн магазин / Учебный проект

# Данные + Для каждого элемента данных - ограничения

1. **User Table:**
    - Поля:
        - `id` (Primary Key, AutoIncrement) - идентификатор пользователя
        - `firstName` (String) - имя пользователя
        - `lastName` (String) - фамилия пользователя
        - `email` (String, Unique) - почта пользователя
        - `password` (String) - пароль (хранится в виде JWT токена)
        - `role` (String, Default: "USER") - роль пользователя (ADMIN/USER)
    - Foreign Keys:
        - `orderId` (int, Foreign Key referencing Order.id) - ссылка на идентификатор заказа пользователя
        - `basketId` (int, Foreign Key referencing Basket.id) - ссылка на идентификатор корзины пользователя
____

2. **Order Table:**
   - Поля:
     - `id` (Primary Key, AutoIncrement) - идентификатор заказа
     - `phone` (String, Not Null) - номер телефона
     - `postcode` (String, Not Null) - почтовый индекс
     - `addressee` (String, Not Null) - адрес
   - Foreign Keys:
     - `userId` (Foreign Key referencing User.id) - ссылка на идентификатор пользователя
____

3. **Basket Table:**
   - Поля:
     - `id` (Primary Key, AutoIncrement) - идентификатор корзины
   - Foreign Keys:
     - `userId` (Foreign Key referencing User.id) - сылка на идентификатор пользователя
____

4. **Product Table:**
   - Поля:
     - `id` (Primary Key, AutoIncrement) - 
     - `name` (String, Unique, Not Null) - название товара
     - `price` (Integer, Not Null) - цена товара
     - `img` (String, Not Null) - изображение товара (хрантися в виде названия файла, поскольку в проекте реализовата статическая раздача файлов, пример вида файла: 0a463753-4a52-47f6-94cf-1364ebf1c7b9.jpg)
     - `_info` (Text, Default: " ") - описание товара, по-умолчанию стоит пустая строка
     - `amount` (Integer, Not Null) - количество товара
     - `country` (String, Not Null) - страна производства
   - Foreign Keys:
     - `typeId` (Foreign Key referencing Type.id) - ссылка на тип из таблицы Type
     - `brandId` (Foreign Key referencing Brand.id) - ссылка на бренд из таблицы Brand
     - `categoryId` (Foreign Key referencing Category.id) - ссылка на категорию из таблицы Category
     - `legalId` (Foreign Key referencing Legal.id) - ссылка на юр. лицо. (поставщика)
____

5. **Category Table:**
   - Поля:
     - `id` (Primary Key, AutoIncrement) - идентификатор категории
     - `name` (String, Unique, Not Null) - название категории
____

6. **Type Table:**
   - Поля:
     - `id` (Primary Key, AutoIncrement) - идентификатор типа
     - `name` (String, Unique, Not Null) - название типа
____

7. **Brand Table:**
   - Поля:
     - `id` (Primary Key, AutoIncrement) - идентификатор бренда
     - `name` (String, Unique, Not Null) - название бренда
____

8. **ProductInfo Table:** (поля дополнительных характеристик товара (излив, тип механизма и т.д.))
   - Поля:
     - `id` (Primary Key, AutoIncrement) - идентификатор характеристики
     - `title` (String, Not Null) - наименование характеристики
     - `description` (String, Not Null) - описание характеристики
   - Foreign Keys:
     - `productId` (Foreign Key referencing Product.id) - ссылка на объект из таблицы Product
____

9. **BasketProduct Table:** (таблица продуктов из корзины пользователя)
   - Поля:
     - `id` (Primary Key, AutoIncrement) - идентификатор
   - Foreign Keys:
     - `basketId` (Foreign Key referencing Basket.id) - ссылка на пользовательскую корзину
     - `productId` (Foreign Key referencing Product.id) - ссылка на продукт из таблицы
____

10. **OrderProduct Table:** (аналогичная система, но для заказов)
    - Fields:
      - `id` (Primary Key, AutoIncrement) - идентификатор
    - Foreign Keys:
      - `orderId` (Foreign Key referencing Order.id) - ссылка на пользовательский заказ
      - `productId` (Foreign Key referencing Product.id) - ссылка на товар
____

11. **Legal Table:** (аналогично как категории, бренды и типы)
    - Fields:
      - `id` (Primary Key, AutoIncrement) - идентификатор поставщика
      - `name` (String, Not Null) - название организации
      - `legal_p` (String, Not Null) - имя юр. лица. представителя
      - `descr` (String) - описание
      - `type` (String, Not Null) - тип организации
      - `phone` (String) - номер телефона
      - `located` (String, Not Null) - где находится их офис 
      - `bill` (String, Not Null) - расчетный счет
      - `inn` (String, Not Null) - ИНН
      - `comment` (String) - доп. комментарий
____



## Описание связей
1. **User и Basket:**
   - `User.hasOne(Basket)` - Один пользователь связан с одной корзиной.
   - `Basket.belongsTo(User)` - Корзина принадлежит конкретному пользователю.

2. **User и Order:**
   - `User.hasMany(Order)` - Один пользователь может иметь много заказов.
   - `Order.belongsTo(User)` - Каждый заказ принадлежит конкретному пользователю.

3. **Order и OrderProduct:**
   - `Order.hasMany(OrderProduct)` - Один заказ может содержать много продуктов.
   - `OrderProduct.belongsTo(Order)` - Каждый продукт в заказе принадлежит конкретному заказу.

4. **Basket и BasketProduct:**
   - `Basket.hasMany(BasketProduct)` - Одна корзина может содержать много продуктов.
   - `BasketProduct.belongsTo(Basket)` - Каждый продукт в корзине принадлежит конкретной корзине.

5. **Product и связанные таблицы:**
   - `Type.hasMany(Product)` и `Product.belongsTo(Type)` - Каждый продукт принадлежит определенному типу.
   - `Brand.hasMany(Product)` и `Product.belongsTo(Brand)` - Каждый продукт принадлежит определенному бренду.
   - `Category.hasMany(Product)` и `Product.belongsTo(Category)` - Каждый продукт принадлежит определенной категории.
   - `Product.hasMany(ProductInfo, {as: 'info'})` и `ProductInfo.belongsTo(Product)` - Каждый продукт может иметь много информации.
    характеристик
6. **Legal и Product:**
   - `Legal.hasMany(Product)` и `Product.belongsTo(Legal)` - Каждый продукт связан с поставщиком.


## Общие ограничения целостности
1. **Ограничения первичного ключа:**
   - У каждой таблицы определен первичный ключ (`id`), который уникален для каждой записи в таблице.

2. **Ограничения внешнего ключа:**
   - Внешние ключи использованы для определения связей между таблицами. Например, `User.hasOne(Basket)` и `Basket.belongsTo(User)` устанавливают внешний ключ в таблице `Basket`, который ссылается на первичный ключ в таблице `User`. Это обеспечивает согласованность данных между таблицами.

3. **Ограничения уникальности:**
   - Некоторые столбцы, например, `email` в таблице `User` и `name` в таблицах `Category`, `Type`, и `Brand`, могут иметь уникальные значения.

4. **Ограничения NOT NULL:**
   - Некоторые столбцы, такие как `allowNull: false` в столбцах `phone`, `postcode`, `addressee` таблицы `Order` и другие, не могут содержать значения `NULL`, что предотвращает появление нулевых значений в обязательных полях.

5. **Ограничения по умолчанию:**
   - В некоторых столбцах, например, `role` в таблице `User` или `_info` в таблице `Product`, установлены значения по умолчанию. Это гарантирует наличие значений по умолчанию в случае отсутствия явного задания значения.

6. **Валидация данных на клиенте:**
    - Предусмотрена валидация вводимых пользователем данных (относится к таблице `User` и др.)

## Схема базы данных
<iframe width="660" height="400" src='https://dbdiagram.io/e/6581ae4156d8064ca0524c53/6581aeb156d8064ca05256b9'> </iframe>

https://dbdiagram.io/d/6581ae4156d8064ca0524c53


# Пользовательские роли, наименование, ответственность, количество пользователей в этой роли
 `USER` и `ADMIN`

1. **USER (Пользователь):**
    - **Просмотр каталога:**
        - Может просматривать все продукты в каталоге.
    - **Просмотр страницы продукта:**
        - Имеет доступ к странице продукта, где отображается основная информация, такая как описание, характеристики, количество товара, тип, бренд и т.д.
    - **Добавление товаров в корзину:**
        - Может добавлять продукты в корзину.
    - **Оформление заказов:**
        - Может оформлять заказы на продукты, находящиеся в корзине.
    - **Авторизация и регистрация:**
        - Может зарегистрироваться в системе и авторизоватьс (при регистрации по умолчанию роль `USER`).
    - **Количество пользователей с данной ролью:**
        - Неограниченное количество. Конечные пользователи, которые используют магазин.
____

2. **ADMIN (Администратор):**
   - **Редактирование товаров:**
        - Может редактировать количество товара и изменять описание товара.
   - **Админ-панель:**
     - Имеет доступ к административной панели, где может управлять следующими сущностями:
        - Добавление/удаление типов, брендов, категорий.
        - Управление поставщиками.
        - Добавление новых товаров с загрузкой изображений и указанием брендов, типов, категорий, поставщиков.
   - **Управление пользователями:**
        - Может просматривать список зарегистрированных пользователей, регистрировать новых пользователей и удалять пользователей при необходимости.
    - **Панель заказов:**
        - Может принимать заказы, закрывать их. Может посмотреть основную информацию пользователя для того, чтобы связаться с ним по поводу заказа.
    - **Количество пользователей с данной ролью:**
        - Ограниченное количество, не более 2ух человек, которые управляют и поддерживают работу магазина.

# UI / API
## UI 
Представляет собой набор страниц с компонентами.
### Для `USER`:
1. **Авторизация**
    <img title="img" alt="hmpg" src="https://i.imgur.com/3B2lqoH.png">
    Ошибка при авторизации
    <img title="img" alt="hmpg" src="https://i.imgur.com/3xVL9qq.png">
    <img title="img" alt="hmpg" src="https://i.imgur.com/W500OAM.png">

2. **Главная страница HomePage**
    <img title="img" alt="hmpg" src="https://i.imgur.com/sJ1kQB1.png">
3. **Магазин Shop**
    <img title="img" alt="shop" src="https://i.imgur.com/BA18ARY.png">
    Пример сортировки по параметрам
    <img title="img" alt="shop" src="https://i.imgur.com/AEbnXMu.png">
    Пример сортировки по цене
    <img title="img" alt="shop" src="https://i.imgur.com/1TZfcVe.png">

4. **Страница товара ProductPage**
    <img title="img" alt="product" src="https://i.imgur.com/bQKpJFN.png">
5. **Корзина Basket**
    <img title="img" alt="basket" src="https://i.imgur.com/g6lF7NJ.png">
    Данные заполняются и отправляются админу на рассмотрение
    <img title="img" alt="basket" src="https://i.imgur.com/6kfMuFe.png">


### Для `ADMIN`: (изменяется также navbar)
1. **Авторизация** - аналогично как и для юзера
2. **Главная страница HomePage**

    Добавляется кнопка обнуления количества товара в каталоге
    <img title="img" alt="hmpg" src="https://i.imgur.com/dVnXbd5.png">
3. **Магазин Shop**
    
    Аналогично изменяется
    <img title="img" alt="hmpg" src="https://i.imgur.com/zQhlKWE.png">
4. **Страница товара ProductPage**

    Добавляется возможность менять описание товара, менять количество, либо обнулять количество
    <img title="img" alt="hmpg" src="https://i.imgur.com/tUtaRQR.png">

5. **Панель заказов Order**
    
    Админ рассматривает, звонит, договаривается и закрывает заказ.
    <img title="img" alt="hmpg" src="https://i.imgur.com/tgDUkTB.png">

6. **Админ панель**

    Управление (добавление/удаление) товаров, типов, брендов, категорий, производителей.
    <img title="img" alt="hmpg" src="https://i.imgur.com/grJv07Q.png">
    Аналогично выглядит и для бренда, категорий
    <img title="img" alt="hmpg" src="https://i.imgur.com/bKm2MGr.png">
    <img title="img" alt="hmpg" src="https://i.imgur.com/pKw8dix.png">
    Добавление товара, где можно загружать изображение товара, привязать тип/брен/категорию (из существующих, созданных админом), а также добавлять сколько угодно характеристик
    <img title="img" alt="hmpg" src="https://i.imgur.com/CuYZSYw.png">
    <img title="img" alt="hmpg" src="https://i.imgur.com/8DfxYJp.png">
    <img title="img" alt="hmpg" src="https://i.imgur.com/IUBsU8D.png">
    Зайдем с роли `USER` и видим результат
    <img title="img" alt="hmpg" src="https://i.imgur.com/seRfzKJ.png">
    Описания нет, поскольку по-умолчанию стоит пустая строка 
    <img title="img" alt="hmpg" src="https://i.imgur.com/4TwIqYC.png">
    Добавим опсание
    <img title="img" alt="hmpg" src="https://i.imgur.com/6CkQFiS.png">
    Теперь удалим этот товар полностью через таблицу delete products
    <img title="img" alt="hmpg" src="https://i.imgur.com/OY7wARS.png">

7. **UserControl панель**
    
    Просмотр всех юзеров, удаление юзеров
    <img title="img" alt="hmpg" src="https://i.imgur.com/yDrUXRj.png">

## Описание API
#### `/user`
 **Маршруты:**
   - `POST /registration`: Регистрация нового пользователя.
   - `POST /login`: Вход пользователя в систему.
   - `GET /auth`: Проверка аутентификации пользователя.

   ***Административные маршруты:***
   - `GET /exact/:id`: Получение информации о конкретном пользователе (требуется аутентификация и роль "ADMIN").
   - `GET /all`: Получение списка всех пользователей (требуется аутентификация и роль "ADMIN").
   - `DELETE /delete/:id`: Удаление пользователя (требуется аутентификация и роль "ADMIN").
____
##### `/type` + аналогично для `/brand`, `/category`, `/legal`
 **Маршруты:**
   - `POST /`: Создание нового типа продукта (требуется аутентификация и роль "ADMIN").
   - `DELETE /:id`: Удаление типа продукта по идентификатору (требуется аутентификация и роль "ADMIN").
   - `GET /`: Получение списка всех типов продуктов.
   - `GET /:id`: Получение информации о конкретном типе продукта.

____
##### `/product`
 **Маршруты:**
   - `POST /`: Создание нового продукта (требуется аутентификация и роль "ADMIN").
   - `POST /update`: Обновление описания продукта (требуется аутентификация и роль "ADMIN").
   - `GET /`: Получение списка продуктов.
   - `GET /all`: Получение списка всех продуктов с дополнительной информацией.
   - `GET /:id`: Получение информации о конкретном продукте.
   - `POST /update/:id`: Обновление количества продукта (требуется аутентификация и роль "ADMIN").
   - `POST /del/:id`: Установка количества продукта в 0 (требуется аутентификация и роль "ADMIN").
   - `DELETE /:id`: Полное удаление продукта (требуется аутентификация и роль "ADMIN").
____

#### `/basket`

 **Маршруты:**
   - `GET /`: Получение корзины пользователя (требуется аутентификация).
   - `POST /`: Добавление продукта в корзину пользователя (требуется аутентификация).
   - `POST /delete`: Удаление продукта из корзины пользователя.
____
#### `/order`

**Маршруты:**
   - `POST /`: Создание нового заказа.
   - `GET /`: Получение списка всех заказов (требуется аутентификация и роль "ADMIN").
   - `GET /order/:id`: Получение заказов пользователя.
   - `GET /order/update/:id`: Обновление статуса заказа (требуется аутентификация и роль "ADMIN").
   - `GET /:id`: Получение списка продуктов в рамках конкретного заказа.
   - `DELETE /:id`: Полное удаление заказа (требуется аутентификация и роль "ADMIN").
____



# Технологии разработки
1. **Node.js** - backend
2. **Express.js** - backend
3. **React.js** - frontend
## Язык программирования
1. **JavaScript**
## СУБД
1. **PostgreSQL**
2. **DBeaver**
3. **PgAdmin 4 v7**
# Тестирование
Проводилось создание тестов для каждой функции из контроллеров и проверка того, что все работает в соответсвии с ожиданиями. 
После тестриования были устранены основные ошибки.


### Отчет по Тестированию API:

1. **Модульное тестирование контроллеров:**
    - Тестирование по основным функциям контроллеров (для get, post, delete запросов)

2. **Интеграционное тестирование API:**
   - Тестирование API как единого целого.
   - Удостоверение в правильной обработке запросов, возвращении корректных статусов ответов и взаимодействии с базой данных без ошибок.

3. **Тестирование работы с базой данных:**
   - Тестирование корректности создания, чтения, обновления и удаления данных в базе данных в контексте заказов, продуктов, корзины и других связанных таблиц.

4. **Тестирование обработки ошибок:**
   - Тестирование обработки ошибок в API, таких как неверные запросы, отсутствие продуктов в корзине, отсутствие заказов и другие.